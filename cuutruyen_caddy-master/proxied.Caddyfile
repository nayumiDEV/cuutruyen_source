{
    auto_https off
}

:3000 {
    @app_matcher {
        path *
        header Cf-Ipcountry VN
    }

    handle /api* {
        encode zstd gzip
        reverse_proxy api:3000
    }

    handle /uploads* {
        header Cache-Control max-age=31536000
        root * /services/cuutruyen/public
        file_server
    }

    handle * {
        encode zstd gzip
        reverse_proxy app:3000
    }
}
